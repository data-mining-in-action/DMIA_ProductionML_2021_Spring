# План курса

План предварительный и будет уточняться по ходу проведения курса. Следите за сообщениями в телеграм-канале курса - там будет информация про важные обновления.

## Структура занятий

- Типичная тема состоит из лекции, семинара и домашнего задания.
- Мы начинаем курс с участия в соревновании про сложность паролей - с ним мы выполним несколько первых домашних заданий.
- После этого мы займемся основным проектом нашего курса - ботом для Шляпы. Мы также устроим соревнование между ботами, в котором определяющую роль помимо самой логики алгоритма будет играть доступность сервиса, его надежность и скорость работы.

## Репозитории

Основные репозитории курса находятся на Gitlab - это связано с тем, что в рамках курса мы будем использовать Gitlab CI. Соответственно, клонировать репозитории тоже нужно сразу на gitlab.

https://gitlab.com/production-ml

## Расписание

Ссылки на презентации будут появляться в процессе чтения курса.

### Неделя 1
- Обзор курса.
- Обзор отрасли.
- Введение в MLOps. 
- Практики написания кода.

### Неделя 2
- Системное администрирование.
- Менеджеры пакетов и виртуальных окружений Python.
- REST API и Flask.

#### Домашнее задание

1) Научиться обращаться с pyenv и настроить ваше рабочее окружение. Научиться пользоваться VSCode / Pycharm, если вы ещё не умеете :) Если у вас есть сервер, на который вы планируете деплоить вашу модель позже (у нас будет такое задание позже) - настроить окружение и на нем, разобраться в файерволах, а когда вы сможете запустить там Flask, проверить, что в модель получается постучаться извне.
2) Обернуть свою модель во Flask и зафиксировать окружение с помощью Pipenv.
    1.  Если вы использовали Jupyter для соревнования, перенести проект в скрипты (используйте PyCharm или VSCode)
    1.  Подготовить пакетное окружение Pipenv и установить в него необходимые пакеты. (Желательно, сразу разделяя на зависимости, необходимые только для разработки, от зависимостей, необходимых для фактической работы базового кода с помощью аргумента  `--dev`)
    1.  Используя классы, подготовить методы для предсказания модели (predict) и ее переобучения (fit).
    1.  С помощью Flask API реализовать на локальной машине возможность получить результат предсказания модели в формате json (можно использовать и другие фреймворки кроме Flask).
    1.  Добавить графический веб-интерфейс (используя Flask или другой фреймворк)
3) Зарегистрироваться и залить свой код в открытый репозиторий на gitlab. Затем - кидайте ссылки на свои репозитории в чат, мы будем смотреть их и лайкать.
4) Изучите репозитории других людей и как они использовали Flask и Pipenv. Сравните со своим решением и постарайтесь понять, как можно было бы улучшить реализацию в репозитории и вашу реализацию. Ставьте звездочки тем, что понравились - 15 мая мы просмотрим несколько наиболее понравившихся репозиториев и обсудим их.

### Неделя 3
- Git, версионирование кода и артефактов. 
- Docker и контейнеризация сервисов. 
- Деплой ML моделей.

#### Домашнее задание
Докер: посмотреть пример в репозитории с паролями, убедиться что все понятно, упаковать в докер свой сервис с паролями, поднять его локально, убедиться что все работает как надо.

Деплой: реализовать деплой сервиса про пароли на heroku в двух вариантах  - напрямую из git-репозитория ([как python package](https://devcenter.heroku.com/articles/getting-started-with-python)) и с помощью Docker ([через heroku.yml](https://devcenter.heroku.com/articles/build-docker-images-heroku-yml)). Базовый пример доступен в репозитории `password-complexity:feature/deploy-heroku-example`. Предполагается, что  будет переиспользован dockerfile из задания на docker. Не забудьте про $PORT! При желании - можно реализовать деплой в любой иной сервис.

### Неделя 4
- Основы хранения и версионирования данных. 
- Сервера в интернете и облачные вычисления. 
- Тестирование ML моделей и сервисов.

#### Домашнее задание
Вам потребуется написать своего бота для Шляпы, пример [the-hat-game](https://gitlab.com/production-ml/the-hat-game). Для начала это может быть просто сервис на Flask или другом веб-фреймворке, который отвечает в нужном формате ответом-заглушкой. Попытайтесь задеплоить его на heroku и убедиться, что это получается. Затем попробуйте усложнить логику ответов, добавив word embeddings или воспользовавшись другими подходами. Имейте в виду, что по правилам использовать для обучения можно лишь [предоставленные данные]().

Как проверить, что вы выполнили задание достаточно хорошо: откройте вашего бота на heroku и проверьте, что сервис отвечает. Отправьте запросы с помощью curl и убедитесь, что формат ответов соответствует приведенному в примерах в репозитории. Попросите членов вашей команды также это проверить.

(Мише) ДЗ на создание своего бота для Шляпы + обвешивание тестами своих ML моделей и сервиса - уже для шляпы (на этом же занятии мы завершаем пароли и делаем анонс про Шляпу). Часть уже написал - нужно будет дополнить

### Неделя 5
- Архитектура ML-систем.
- [Создание ML пайплайнов]().

#### Домашнее задание
Вам потребуется написать ML Pipeline для своего бота-игрока в Шляпу, подобный тому, что мы разбирали на семинаре. Он есть в нашем репозитории [passwords-complexity](https://gitlab.com/production-ml/password-complexity). В итоге, этот пайплайн должен запускаться скриптом run_all.sh или аналогичным на bash, Python или другом языке. Важно, что окружение должно создаваться автоматически - для этого может использоваться pipenv ("pipenv run my_pipeline.py") или docker ("docker run ml_pipeline"). Docker предпочтительнее, поскольку позже мы будем запускать созданный докер-образ в рамках CI/CD. Если для запуска требуется определенная подготовка - например, нужно установить Docker или pipenv, напишите об этом в инструкции. 

Как проверить, что вы выполнили задание достаточно хорошо: дайте выполнить эту задачу другому члену команды по текстовой инструкции, а если он тоже в этом участвовал - то попробуйте склонировать свой репозиторий на новую машинку и запустить этот скрипт следуя вашей инструкции шаг за шагом. В процессе выполнения должны скачиваться новые данные, распечатываться необходимые метрики, сохраняться новая модель.

### Неделя 6
- Воспроизводимость экспериментов. 
- Мониторинг сервисов и ML моделей.
- Шляпа - промежуточный раунд 0

#### Домашнее задание
ДЗ про воспроизводимость экспериментов - залогировать свои эксперименты neptune, добиться их воспроизводимости (на разных машинках, например. Способ проверки - выкачать на новую машинку репозиторий и перезапустить эксперимент, сравнить метрики), добавить критерий обновления модели в сервисе в staging/production (сейчас это просто критерий, позже мы встроим это в CI/CD).

ДЗ про мониторинг - поднять прометеус/графану, убедиться, что метрики собираются, настроить дашборды, алерты

### Неделя 7
- Построение CI/CD, автоматизация тестирования, сборки и деплоя пайплайнов и сервисов.
- Шляпа - промежуточный раунд 1

#### Домашнее задание

Вам потребуется настроить CI/CD для своего бота для игры в Шляпу. Примеры - в [passwords-complexity](https://gitlab.com/production-ml/password-complexity) и [ci-cd-example](https://gitlab.com/production-ml/ci-cd-example). В рамках CI/CD должен тестироваться, собираться и запускаться ML Pipeline (скачиваться новые данные, обучаться модель, сохраняться метрики и артефакты), приниматься решение об обновлении модели и затем новая модель должна заворачиваться в сервис, тестироваться и деплоиться на ваш staging или production. Запуск пайплайна нужно настроить по расписанию - например, ежедневно.

Как проверить, что вы выполнили задание достаточно хорошо: для начала проверьте, что ваш пайплайн запускается и отрабатывает без каких-либо проблем один или несколько дней. Проверьте внимательно, что обучение модели происходит одинаково на одном наборе данных (то есть воспроизводимо. Например, можно запустить пайплайн два раза подряд и сравнить метрики или ответы модели на один запрос), что вы забираете свежие данные (косвенно это можно проверить если метрики моделей изменяются в разные дни), деплоится именно новая модель, а не старая (можно логировать вывод на один и тот же запрос и проверять, что он меняется), что prometheus/grafana собирают нужные метрики всё время (зайдите в графану и проверьте, что метрики есть на протяжении тех дней, когда работал ваш пайплайн).

### Неделя 8
- Подведение итогов курса.
- Обзор дальнейшего развития, задач и целей для ML Engineer.
- Шляпа - промежуточный раунд 2

### Неделя 9
- Шляпа - финал. Боевая проверка реализаций курсового проекта.
